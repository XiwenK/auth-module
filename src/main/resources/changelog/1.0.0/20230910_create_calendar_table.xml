<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet id="20230910_create_calendar_table" author="Alexandr Manunin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                <![CDATA[
                        SELECT count(*)
                            FROM information_schema.tables
                        WHERE table_schema = 'public'
                         AND table_name = 'calendars';
                ]]>
            </sqlCheck>
        </preConditions>
        <sql>
            create table CALENDARS
            (
            ID              bigserial    not null,
            NAME            text         not null,
            DESCRIPTION     text,
            DATA            jsonb,
            IS_SYSTEM       boolean      default false not null
            );

            create unique index CALENDARS_uindex on CALENDARS (ID);

            alter table CALENDARS add constraint CALENDARS_pk primary key (ID);

            COMMENT ON TABLE CALENDARS IS 'Calendars table';

            COMMENT ON COLUMN CALENDARS.ID             IS 'Calendar id';
            COMMENT ON COLUMN CALENDARS.NAME           IS 'Calendar name';
            COMMENT ON COLUMN CALENDARS.DESCRIPTION    IS 'Calendar description';
            COMMENT ON COLUMN CALENDARS.DATA           IS 'Calendar data';

        </sql>
        <rollback>
            <dropTable tableName="CALENDARS"/>
        </rollback>
    </changeSet>


    <changeSet id="20230530_add_schedule_data_add_default" author="Alexandr Manunin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
            <![CDATA[
                SELECT count(*)
                FROM information_schema.tables
                WHERE table_schema = 'public'
                  AND table_name = 'calendars';
                ]]>
        </sqlCheck>
        </preConditions>
        <sql>
            insert into CALENDARS (NAME, DESCRIPTION, IS_SYSTEM) values ('Standard', 'Standard calendar', true);
        </sql>
        <rollback/>
    </changeSet>
</databaseChangeLog>